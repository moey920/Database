# 공유 킥보드 DB 작성 실습

## 공유 킥보드 운영 방침 (대여 관련)

1. 원활한 대여 관리를 위해 대여 정보는 대여한 킥보드의 ID, 대여한 고객의 ID, 대여해간 날짜로 구성된다.

2. 대여한 킥보드의 ID는 실제 운영(소유)하고 있는 킥보드 ID(영문 + 숫자 조합으로 3자리)만 입력 될 수 있다.

3. 대여한 고객의 ID는 실제 가입한 고객의 ID(영문 + 숫자 조합으로 15자리 미만) 만 입력 될 수 있다.

4. 대여 일자는 년-월-일 시:분 (YYYY-MM-DD HH:MM)으로 입력되며 고객은 킥보드 대여 후 1분 이내 다시 대여할 수 없다.
단, 고객이 대여할 수 있는 킥보드의 대수에는 제한이 없다.

## 코더랜드 공유 킥보드 운영 방침 (킥보드)

1. 킥보드 관리를 위해 모든 킥보드는 이미지 정보, 종류 정보, 연식 정보, ID를 가지고 있다.

2. 킥보드의 ID는 중복이 되거나 수정 할 수 없다.

3. 킥보드의 이미지는 50자 미만의 URL로 구성되어 있으며 연식과 종류가 같은 킥보드일 경우
동일한 이미지를 활용한다.

4. 킥보드의 종류는 브레이크의 위치에 따라 두가지(뒷바퀴에 위치 ‒ A형, 핸들에 위치 - B형)로 구분되며 중복이 가능하다.

5. 킥보드의 연식는 킥보드의 생산년도로 4자리 숫자(YYYY)로 표현되며 중복이 가능하다.

## 코더랜드 공유 킥보드 운영 방침 (고객)

1. 고객 관리를 위해 모든 고객은 ID, 이름, 전화번호를 가지고 있다.

2. 고객 ID는 으로 구성되어 있으며 ID는 중복이 되거나 수정 될 수 없다.

3. 고객의 이름는 10자 미만의 한글로 구성되어 있으며 동명이인을 고려하여 중복이 가능하다.

4. 고객의 전화번호는 15자 미만의 문자(***-****-****)로 구성되어 있다.

5. 대여 중인 킥보드가 없어야 회원 탈퇴(고객 정보 삭제)가 가능하다.

> 각 운영 방침을 참고하여 연관성 있는 내용들은 묶어 정리해보자

### 대여 관련 정보

| 구분 | 타입 | 속성명 | 예시 |
|---|:---:|:---:|:---:|
| `대여일자` | `varchar(20)` | `rental_date` | `2020-10-01 11:00` |
| `대여한 고객 ID` | `varchar(15)` | `customer_id` | `elice_rabbit` |
| `대여한 킥보드 ID` | `varchar(5)` | `kickboard_id` | `E01` |

- varchar 는 문자형 타입을 의미하며 뒤에 괄호 안에 의미는 해당 문자열의 크기(byte)를 의미
(영문자 기준 1글자 당 1byte 를 사용)

### 킥보드 관련 정보

| 구분 | 타입 | 속성명 | 예시 |
|---|:---:|:---:|:---:|
| `킥보드 ID` | `varchar(5)` | `kickboard_id` | `E01` |
| `킥보드 종류` | `varchar(5)` | `kickboard_kind` | `A` |
| `킥보드 이미지` | `varchar(50)` | `kickboard_img` | `https://~~` |
| `킥보드 연식` | `int` | `kickboard_year` | `2019` |

### 고객 관련 정보

| 구분 | 타입 | 속성명 | 예시 |
|---|:---:|:---:|:---:|
| `고객 ID` | `varchar(15)` | `customer_id` | `elice_rabbit` |
| `이름` | `varchar(20)` | `customer_name` | `엘리스 토끼` |
| `전화번호` | `varchar(15)` | `customer_tel ` | `010-1234-5678` |

## 네이밍 규칙

 - 유지보수와 의미의 명확성을 전달하기 위해 네이밍 규칙을 설정

1. 공통 규칙
    1. 줄임말 사용은 최소화한다. (단, 사용할 경우 범용적으로 사용되는 줄임말을 사용한다.)
        - kb_image (X) → kickboard_image (O)
        - tb_KickboardInfo (△) (Info: Information의 줄임말)

2. 테이블 네이밍 규칙
    1. 테이블 명을 작성할 때는 파스칼 표기법을 사용한다
        - kickboardRental (X) → KickboardRental (O)
        - tCustomerInfo (X) → CustomerInfo (O)
    2. 테이블, 뷰(View)임을 한 눈에 확인 할 수 있도록 테이블 명 앞에는 ‘tb_’, ‘v_’ 를 붙인다.(스네이크 표기법 사용)
        - tb_KickboardRental (킥보드 대여와 관련된 테이블)
        - v_KickboardInfoForAnalysis (데이터 분석을 위해 필요한 정보만 모아 둔 가상 테이블)

3. 속성 네이밍 규칙
    1. 속성 명을 작성할 때는 스네이크 표기법을 활용한다
        -customerID (X) → customer_id (O)
        -CustomerTel (X) → customer_tel (O)
    2. 유일키, 외래키 등은 한 눈에 알아 볼 수 있도록 속성 명 앞에 ‘pk_’, ‘fk_’를 붙인다.
        (단, 중복으로 설정되어 있는 경우 외래키 > 유일키 순으로 작성한다.)
        - pk_kickboard_id
        - fk_pk_customer_id

### 네이밍 케이스 종류
- 파스칼 표기법 : 앞, 뒤 모두 대문자로 시작
- 카멜 케이스 : 뒷 문자열만 대문자로 시작
- 스네이크 케이스 : 앞, 뒤 문자열 사이에 _ 삽입

## KEY 설명
- Key란? 데이터베이스에서 튜플(레코드,행)간 구분을 위한 값(속성)

### 유일키(PRIMARY KEY)
- 어떤 값(속성)을 **유일키(PK)**로 지정할까?
    - 누가 키보드를 빌려 갔는지 중요하며 **중복이 되지 않는** 고객ID를 유일키(Primary Key)로 선택

#### 유일키(PK) 선언 방법
```
CREATE TABLE `테이블 명`{
    `속성명` 타입,
    `속성명2` 타입,
    …
    PRIMARY KEY (`유일키로 사용할 속성 명`)
}
```
* 속성 이름 등을 사용할 때는 ''이 아닌 ``로 묶어줌에 유의한다.

### 복합키(Composite Key)

- 만약 고객 ‘엘리스 토끼’가 10월 4일에 E01 모델을 한번 더 대여한다면?
    + 유일키 (Primary Key) 중복 발생!

- 복합키(CK)란? 
    + 두 개 이상의 속성을 활용하여 튜플(레코드, 행)을 구분지어주는 방법

- 어떤 속성을 추가하여 복합키를 구성할까?
    + 누가, 언제 킥보드를 빌려 갔는지 중요하기 때문에
대여 일자를 추가하여 복합키를 구성
    + 처음과 동일하게 고객 ID가 중복되지만
또 다른 속성인 대여 일자가 달라 서로 다른 행으로 처리

#### 복합키(CK) 선언 방법
```
CREATE TABLE `테이블 명`{
    `속성명` 타입,
    `속성명2` 타입,
    …
    PRIMARY KEY (`복합키로 사용할 속성 명`, `복합키로 사용할 속성 명`)
}
```
* 유일키 선언과 비슷한 구조이며 괄호 안에 복합키로 사용할 속성들을 작성하면 됨

### 외래키(Foreign Key)

- 10월 5일에 도도새가 킥보드를 빌려간 내용을 추가하던 중에
실수로 도도새의 ID를 ‘dododo_bird’로 입력 한다면?
    + 아무런 오류 출력 없이 데이터가 추가됨
    + 도도새의 ID는 ‘dodo_bird’? ’dododo_bird’?
        - **실제 존재하지 않은 데이터가 추가되어 추후 관리에 문제 발생**

- 외래키(Foreign Key)이란?
    + **다른 테이블의 키와 연결을 해주는 키**이며 ,
**참조의 무결성을 유지**하기 위해 활용
        - **참조의 무결성**: 외래키 값이 참조 중인 테이블의 값과 일관성을 가지는 것을 의미

- 어떻게 외래키를 생성하고 연결할까?
    + 고객의 ID에 대해 따로 테이블을 구성, 고객 테이블의
‘고객ID’ 속성을 참조하는 외래키 구성
    + 새로 추가하려는 행 중 외래키인 ‘고객 ID’의 내용이
고객 테이블에 있지 않은 내용이므로 추가 되지 않음

#### 외래키(Foreign Key) 선언 방법
```
CREATE TABLE `테이블 명`{
    `속성명` 타입,
    `속성명2` 타입,
    …
    FOREIGN KEY (`외래키로 사용할 속성 명`) REFERENCES `참조하는 속성이 있는 테이블` (`참조할 속성 명`)
}
```
* 어느 위치에 어떤 내용이 들어가는지 주의!

----------------------------------------------------

# 정규화(Normalization)

- 정규화(Normalization)란?
> 테이블 간 데이터 조작(삽입, 수정, 삭제) 시 발생 할 수 있는
이상 현상을 줄이기 위해 하는 작업

- 정규화의 종류
    - 1차 정규화
    - ...
    - 5차 정규화
    - BCNF
> 다양한 정규화 종류가 있지만 1~3차 정규화까지 진행하면 대부분의 이상현상을 없앨 수 있음

## 1차 정규화(1NF)

> 각 속성 마다 값이 1개씩 존재하도록 하는 과정 (원자화)

- 1차 정규화가 이루어지지 않은 테이블
    - 각 속성에 여러 값이 들어가있을 수 있다.
    - 10월 1일에 엘리스 토끼가 대여한 정보를 삭제한다면?
        > 각 속성 마다 원자화가 되어 있지 않아 모자 장수의 대여 기록도 **같이 삭제되는 문제** 발생

- 1차 정규화가 이루어진 테이블
    - 다른 데이터에 영향을 끼치지 않고 데이터 조작이 가능

## 2차 정규화(2NF)

> 복합키로 구성 되어있을 때 고려해야하며
모든 속성이 완전 함수 종속이 되도록 하는 작업

### 완전 함수 종속

> A, B, C, D가 있을 때 B가 A에 의해 종속되는 경우
B는 다른 내용(C, D)에 의해 종속이 되지 않는 경우

- 10월 01일에 킥보드를 대여해간 엘리스 토끼의
전화번호를 010-0000-2222로 변경한다면?
    - 동일한 고객인 10월 02일의 엘리스 토끼와 데이터가 일치하지 않는 상황 발생
    - 고객 이름과 전화번호는 고객의 ID에 종속되어 있음
이 두 속성을 대여 테이블로부터 분리시켜 종속성을 제거
        > 엘리스 토끼의 전화번호를 수정하기 위해 고객 테이블의 전화번호를 수정, 그 후 10월 02일 엘리스 토끼의 전화번호를 확인해보면 변경된 전화번호를 얻을 수 있음

----------------------------------------------------

# View (뷰)

- View (뷰)란?
> 하나 이상의 테이블에서 여러 정보를 토대로 만들어지는 가상의 테이블

- 정규화의 종류
    - 1차 정규화
    - ...
    - 5차 정규화
    - BCNF
> 다양한 정규화 종류가 있지만 1~3차 정규화까지 진행하면 대부분의 이상현상을 없앨 수 있음

## 1차 정규화(1NF)

> 각 속성 마다 값이 1개씩 존재하도록 하는 과정 (원자화)

- 1차 정규화가 이루어지지 않은 테이블
    - 각 속성에 여러 값이 들어가있을 수 있다.
    - 10월 1일에 엘리스 토끼가 대여한 정보를 삭제한다면?
        > 각 속성 마다 원자화가 되어 있지 않아 모자 장수의 대여 기록도 **같이 삭제되는 문제** 발생

- 1차 정규화가 이루어진 테이블
    - 다른 데이터에 영향을 끼치지 않고 데이터 조작이 가능
